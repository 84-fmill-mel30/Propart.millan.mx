<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROPART V55 - REAL</title>
    <style>
        body { 
            background-color: #000; 
            color: #00ff00; 
            font-family: 'Courier New', monospace; 
            text-align: center; 
            padding: 20px;
        }
        .btn-real {
            background-color: #00ff00;
            color: #000;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 50px;
            box-shadow: 0 0 20px #00ff00;
        }
        .console {
            margin-top: 30px;
            border: 1px solid #333;
            background: #111;
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
            text-align: left;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <h1>PROPART V55<br>CONEXI√ìN DIRECTA</h1>
    <p>Protocolo: Web Bluetooth API</p>

    <button class="btn-real" id="btnConnect">üîµ CONECTAR A VCI</button>

    <div class="console" id="logBox">
        > Sistema listo.<br>
        > Esperando usuario...
    </div>

    <script>
        const btn = document.getElementById('btnConnect');
        const logBox = document.getElementById('logBox');

        function log(text) {
            logBox.innerHTML += "> " + text + "<br>";
            logBox.scrollTop = logBox.scrollHeight;
        }

        btn.addEventListener('click', async () => {
            log("Iniciando escaneo de hardware...");
            
            try {
                // ESTA ES LA ORDEN REAL AL CHIP BLUETOOTH DE TU CELULAR
                const device = await navigator.bluetooth.requestDevice({
                    // 'acceptAllDevices' fuerza a mostrar TODO lo que encuentre cerca
                    acceptAllDevices: true,
                    optionalServices: ['0000fff0-0000-1000-8000-00805f9b34fb'] // Servicio OBDII com√∫n
                });

                log("‚úÖ DISPOSITIVO ENCONTRADO: " + device.name);
                log("Intentando enlazar...");
                
                const server = await device.gatt.connect();
                
                log("üîì CONECTADO AL VCI CORRECTAMENTE");
                log("Hardware vinculado. Listo para recibir datos.");
                
                // Aqu√≠ ya estamos conectados de verdad.
                
            } catch (error) {
                log("‚ùå ERROR DE CONEXI√ìN:");
                log(error);
                if (error.toString().includes('cancelled')) {
                    log("Aviso: Cancelaste la lista de dispositivos.");
                } else {
                    log("Aseg√∫rate de que el Bluetooth est√© PRENDIDO.");
                }
            }
        });
    </script>

</body>
</html>
